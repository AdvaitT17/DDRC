<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Login | DDRC</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet" />
  <link rel="stylesheet" href="/css/main.css" />
  <link rel="stylesheet" href="/css/header.css" />
  <link rel="stylesheet" href="/css/footer.css" />
  <link rel="stylesheet" href="/login/css/style.css" />
  <link rel="stylesheet" href="/css/accessibility.css" />
</head>

<body>
  <!-- Accessibility Announcement for Screen Readers -->
  <div id="screenReaderAnnouncer" class="sr-only" role="alert" aria-live="polite"></div>

  <!-- Auth check loader -->
  <div id="authLoader" class="auth-loader" aria-label="Checking authentication status">
    <div class="spinner" role="status" aria-label="Loading..."></div>
  </div>

  <!-- Main content will be hidden until auth check -->
  <div id="mainContent" style="display: none">
    <!-- Site Header Component -->
    <div id="site-header"></div>

    <!-- Main Content -->
    <main class="auth-container" id="main-content" role="main" tabindex="-1">
      <div class="auth-box">
        <div class="auth-header">
          <h2>Login to Continue</h2>
          <p>Access your account</p>
        </div>

        <form id="loginForm" class="auth-form" novalidate aria-label="Login form">
          <div class="alert alert-danger" style="display: none" id="loginError" role="alert"></div>

          <div class="form-group">
            <label for="email">Email</label>
            <input type="email" class="form-control" id="email" name="email" required aria-required="true"
              placeholder="Enter your email" />
            <div class="invalid-feedback">Please enter a valid email</div>
          </div>

          <div class="form-group">
            <label for="password">Password</label>
            <div class="password-input">
              <input type="password" class="form-control" id="password" name="password" required aria-required="true"
                placeholder="Enter your password" />
              <button type="button" class="toggle-password" aria-label="Toggle password visibility">
                <img src="/images/eye.svg" alt="Show password icon" class="eye-icon" />
              </button>
            </div>
            <div class="invalid-feedback">Please enter your password</div>
          </div>

          <button type="submit" class="btn btn-primary w-100">Login</button>

          <div class="auth-footer">
            <p>
              <a href="/forgot-password">Forgot Password?</a>
            </p>
            <p style="display:inline;">Don't have an account? </p>
            <p style="display:inline;"><a href="/registration">Register here</a></p><br>
            <p style="display:inline;">Unable to access your account? </p>
            <p style="display:inline;"><a href="/contact">Contact Us</a></p>
          </div>
        </form>
      </div>
    </main>

    <!-- Footer -->
    <footer role="contentinfo" aria-label="Site Footer">
      <div class="footer-content">
        <div class="footer-section">
          <h3>About</h3>
          <ul>
            <li>
              <a href="/about-ddrc" aria-label="Know more about DDRC">Know more about DDRC</a>
            </li>
            <li>
              <a href="/schemes" aria-label="Schemes for Persons with Disabilities">Schemes for Persons with
                Disabilities</a>
            </li>
            <li>
              <a href="/about-department" aria-label="About Department">About Department</a>
            </li>
            <li>
              <a href="/medical-camps" aria-label="Medical Camps and Hospitals">Medical Camps / Hospitals</a>
            </li>
          </ul>
        </div>
        <div class="footer-section">
          <h3>Quick Access Key</h3>
          <ul>
            <li>H = Go to Home Page</li>
            <li>S = Skip to main content</li>
            <li>F = Site Search</li>
            <li>T = Back to Top</li>
          </ul>
        </div>
        <div class="footer-section">
          <h3>Use keyboard for quick access</h3>
          <ul>
            <li>Internet Explorer - [Alt] + accesskey</li>
            <li>Chrome - [Alt] + accesskey</li>
            <li>Firefox - [Alt] [Shift] + accesskey</li>
            <li>Safari - [Alt] + accesskey</li>
          </ul>
        </div>
      </div>
      <div class="footer-bottom">
        <p>
          &copy; Copyright
          <script>
            document.write(new Date().getFullYear());
          </script>
          District Disability Rehabilitation Centre, Mumbai. All Rights
          Reserved.
        </p>
        <div class="footer-links">
          <a href="/terms" aria-label="Terms and Conditions">Terms & Conditions</a>
          <a href="/privacy" aria-label="Privacy Policy">Privacy Policy</a>
          <a href="/copyright" aria-label="Copyright Policy">Copyright Policy</a>
          <a href="/accessibility" aria-label="Accessibility Statement">Accessibility Statement</a>
        </div>
      </div>
    </footer>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
  <script src="/js/auth.js"></script>
  <script src="/js/components/header.js"></script>
  <script src="/js/accessibility.js"></script>
  <script>
    // Check auth status before showing login page
    document.addEventListener("DOMContentLoaded", async () => {
      try {
        const isAuth = await AuthManager.verifyAuth();
        if (isAuth) {
          // Check registration status
          const response = await fetch("/api/registration/check-status", {
            headers: {
              Authorization: `Bearer ${AuthManager.getAuthToken()}`,
            },
          });
          const data = await response.json();

          // Redirect based on registration status
          if (data.hasRegistration) {
            window.location.href = "/dashboard";
          } else {
            window.location.href = "/registration/form";
          }
          return;
        }

        // Show login form if not authenticated
        document.getElementById("authLoader").style.display = "none";
        document.getElementById("mainContent").style.display = "block";

        // Announce to screen readers
        if (typeof window.announceScreenReaderMessage === "function") {
          window.announceScreenReaderMessage("Login page loaded");
        }
      } catch (error) {
        console.error("Auth check error:", error);
        // Show login form on error
        document.getElementById("authLoader").style.display = "none";
        document.getElementById("mainContent").style.display = "block";

        // Announce error to screen readers
        if (typeof window.announceScreenReaderMessage === "function") {
          window.announceScreenReaderMessage(
            "Authentication check failed. Login page loaded"
          );
        }
      }
    });
  </script>
  <script src="/login/js/login.js"></script>
</body>

</html>